services:
  finance-server:
    build: .
    container_name: finance-domain-server
    environment:
      - MCP_URL=${MCP_URL:-http://host.docker.internal:8000/sse}
      - PYTHONPATH=/app
    ports:
      - "8001:8001"
    volumes:
      - ./registry.db:/app/registry.db
    command: python domains/finance/server.py
    extra_hosts:
      - "host.docker.internal:host-gateway"

  agent:
    build: .
    container_name: finance-agent
    stdin_open: true # Allows interactive CLI
    tty: true # Allows interactive CLI
    environment:
      - OLLAMA_URL=${OLLAMA_URL:-http://host.docker.internal:11434}
      - REGISTRY_DB_PATH=/app/registry.db
      - DB_PATH=/app/agent.db
      - MCP_URL=${MCP_URL:-http://host.docker.internal:8000/sse}
      - PYTHONPATH=/app
    volumes:
      - ./registry.db:/app/registry.db
      - ./agent.db:/app/agent.db
    depends_on:
      - finance-server
    command: python main.py run
    extra_hosts:
      - "host.docker.internal:host-gateway"

volumes:
  db-data:
